<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <div th:include="index :: header" ></div>


</head>
<body>

<div  id="toolbar" >
    <form class="form-inline">
        <table >
            <tr>
                <td>商品名称或编号：<input type="text" id="bookname" class="form-control" placeholder="商品名称或编号"></td>
            </tr>
            <tr>
                <td>商品时间：
                    <input type="date" class="form-control date"  id="startTime">--
                    <input type="date" class="form-control date"  id="endTime">
                    温馨提示（当前时间）：<span id="tishispId"></span>
                </td>
            </tr>
            <tr>
                <td>状态：<select  id="searchType" class="form-control">
                    <option value="-1">请选择</option>
                    <option value="1">已上架</option>
                    <option value="2">未上架</option>
                </select></td>
            </tr>
            <tr>
                <td colspan="10">
                    <div class="text-center">
                        <button onclick="searchbook()" type="button" class="btn btn-info"><span class="glyphicon glyphicon-search">搜索</span></button>
                    </div>
                </td>
            </tr>
        </table>
    </form>
    <button type="button" onclick="deleteBook()" class="btn btn-success glyphicon glyphicon-trash">批量删除</button>
    <button type="button" onclick="INSTRBook()" class="btn btn-success glyphicon glyphicon-edit">导入商品</button>
    <button type="button" onclick="daochu()" class="btn btn-success glyphicon glyphicon-paste">导出商品</button>
</div>

<table class="table" id="myTable"></table>
</body>
<script>
    function tishi(){
        var tishispObj = document.getElementById("tishispId");
        var date=new Date();
        tishispObj.innerHTML= date.toLocaleString() ;
    }
    setInterval("tishi()",1000);

    $(function(){
        initcommodityTable();
        tishi();
    })
    var res;
    function createAddContent(url){
        $.ajax({
            url:url,
            async:false,//同步
            success:function(data){
                res = data;
            }
        });
        return res;
    }
//导入INSTRBook（）
    function INSTRBook() {
            bootbox.dialog({
                title:'Excel导入',
                message: createAddContent("/ldl/toAddExcel"),
                closeButton: true,//是否显示关闭按钮
                buttons : {
                    "success" : {
                        "label" : "<i class='icon-ok'></i> 导入",
                        "className" : "btn-sm btn-success",
                        "callback" : function() {
                            $.ajax({
                                url:'/ldl/addCommodity',
                                dataType: 'text',
                                data:$("#poiForm").serialize(),
                                success:function(data){
                                   if(data){
                                       sercherQuery();
                                   }
                                    alert("导入失败")
                                }
                            });
                        }
                    },
                    "cancel" : {
                        "label" : "<i class='icon-info'></i> 取消",
                        "className" : "btn-sm btn-danger",
                        "callback" : function() {

                        }
                    }
                }

            });



        }
    //导出daochu
    function daochu() {
        //获取所有被选中的记录
        var books = $("#myTable").bootstrapTable('getSelections');
        if (books.length== 0) {
            alert("请先选择要导出的数据!");
            return;
        }
        bootbox.confirm("你确定要导出吗?", function(result){
            if(result){
                var ids = '';
                for (var i = 0; i < books.length; i++) {
                    ids+=ids==""? books[i].id:","+books[i].id;
                }
                $.ajax({
                    url:'../ldl/daochu',
                    type:'post',
                    data:{ids:ids},
                    success:function(data){
                        if(data){
                            alert("导出成功")
                            searchbook();
                        }else{
                            alert("导出失败")
                        }
                    }
                })
            }
        })


    }
    //批量删除
    function deleteBook() {
        //获取所有被选中的记录
        var books = $("#myTable").bootstrapTable('getSelections');
        if (books.length== 0) {
            alert("请先选择要删除的记录!");
            return;
        }
        bootbox.confirm("你确定要删除吗?", function(result){
            if(result){
                var ids = '';
                for (var i = 0; i < books.length; i++) {
                    ids+=ids==""? books[i].id:","+books[i].id;
                }
                $.ajax({
                    url:'../ldl/deleteBook',
                    type:'post',
                    data:{ids:ids},
                    success:function(data){
                        if(data){
                            searchbook();
                        }else{
                            alert("删除失败")
                        }
                    }
                })
            }
        })


    }
    //调查
    function searchbook(){
        var bookname=$("#bookname").val();
        var startTime=$("#startTime").val();
        var endTime=$("#endTime").val();
        var searchType=$("#searchType").val();

        $("#myTable").bootstrapTable('refresh',{
            query:{
                name:bookname,
                startTime:startTime,
                endTime:endTime,
                state:searchType
            }
        })
    }
    //查询
    function initcommodityTable(){
        $("#myTable").bootstrapTable({
            url:'/ldl/querycommodity',
            toolbar:'#toolbar',
            method: 'post',
            contentType: 'application/x-www-form-urlencoded',//posti求按照表单方式
            pagination:true,//是否展示分页
            showRefresh:true,
            pageNamber:1,//起始页
            pageSize:5,//每页条数
            pageList:[2,5,10,20],
            sidePagination:'server',//分页方式：client客户端分页，server服务端分页（*
            striped:true,//是否显示斑马线
            queryParams:function(){
                return {
                    page:this.pageNumber,
                    rows:this.pageSize
                };
            },
            columns:[
                {field:"abc",checkbox:true},
                {field:"number",title:"编号",width:100},
                {field:"name",title:"名称",width:150,formatter:function(value,row,index){
                    if(row.money==null || row.money=='' ||row.money=="-"){
                        return "<font color='#ff0000'>"+value+"<font>";
                    }else{
                        return "<font color='#00ff00'>"+value+"<font>";
                    }
                    }},
                {field:"datetime",title:"创建时间",width:150},
                {field:"state",title:"是否上架",width:50,formatter:function(value,row,index){
            if(row.state==1){
                return "<font color='#00ff00'size=\"+5\">√<font>";
            }else{
                return "<font color='#ff0000'size=\"+5\">×<font>";
            }

        }},
                {field:"goodsname",title:"商品分类",width:150},
                {field:"money",title:"商品价格",width:50},
                {field:"url",title:"路径",width:150},
                {field:"url",title:"操作",width:150,formatter:function(value,row,index){
                        var str = "<a href="+value+"><button class='btn btn-success glyphicon glyphicon-search'>查看</button></a>|";

                        return str;
                    }}
            ]
        })
    }
</script>


</html>