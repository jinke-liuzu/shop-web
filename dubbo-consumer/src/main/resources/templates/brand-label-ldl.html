<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<link rel="stylesheet"  href="/js/bootstrap/css/bootstrap.min.css"  >
    <link rel="stylesheet"  href="/js/treeview/bootstrap-treeview.min.css"  >
    <link rel="stylesheet"  href="/js/addTabs/addTabs.css"   >
    <link rel="stylesheet"  href="/js/table/bootstrap-table.min.css"    >

    <script type="text/javascript" src="/js/jquery.min.js" ></script>
    <script type="text/javascript" src="/js/my97/WdatePicker.js" ></script>
    <script type="text/javascript" src="/js/bootstrap/js/bootstrap.min.js"  ></script>
    <script type="text/javascript" src="/js/treeview/bootstrap-treeview.min.js" ></script>
    <script type="text/javascript" src="/js/addTabs/addTabs.js" ></script>
    <script type="text/javascript" src="/js/table/bootstrap-table.min.js" ></script>
    <script type="text/javascript" src="/js/table/locale/bootstrap-table-zh-CN.min.js" ></script>
    <script type="text/javascript" src="/js/bootbox/bootbox.js" ></script>

    <link rel="stylesheet"  href="/js/fileinput/css/fileinput.min.css" />
    <script type="text/javascript" src="/js/fileinput/js/fileinput.min.js" ></script>

    <script type="text/javascript" src="/js/fileinput/themes/fa/theme.js" ></script>
    <script type="text/javascript" src="/js/fileinput/js/locales/zh.js" ></script>-->

    <!-- 引入jquery -->
    <script type="text/javascript" src="/js3/jquery-1.9.1.min.js"></script>
    <!-- 引入bootstrap的css、js -->
    <link rel="stylesheet" href="/js3/bootstrap3/css/bootstrap.css">
    <script type="text/javascript" src="/js3/bootstrap3/js/bootstrap.js"></script>
    <!-- 引入tree的js、css -->
    <link rel="stylesheet" href="/js3/bootstrap-treeview/bootstrap-treeview.min.css">
    <script type="text/javascript" src="/js3/bootstrap-treeview/bootstrap-treeview.min.js"></script>
    <!-- 引入选项卡的js、css -->
    <link rel="stylesheet" href="/js3/bootStrap-addTabs/bootstrap.addtabs.css">
    <script type="text/javascript" src="/js3/bootStrap-addTabs/bootstrap.addtabs.min.js"></script>
    <!-- 引入table的css、js -->
    <link rel="stylesheet" href="/js3/bootstrap-table/bootstrap-table.css">
    <script type="text/javascript" src="/js3/bootstrap-table/bootstrap-table.js"></script>
    <script type="text/javascript" src="/js3/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
    <!-- 引入删除提示框 -->
    <script type="text/javascript" src="/js3/bootbox/bootbox.min.js"></script>
    <!-- 引入时间的css、js -->
    <link rel="stylesheet" href="/js3/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <script  src="/js3/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script  src="/js3/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <!-- 引入文件上传的css、js -->
    <link rel="stylesheet" href="/js3/bootstrap-fileinput/css/fileinput.css">
    <script type="text/javascript" src="/js3/bootstrap-fileinput/js/fileinput.js"></script>
    <script type="text/javascript" src="/js3/bootstrap-fileinput/js/locales/zh.js"></script>
<style>

</style>
</head>
<body>
<form class="form-inline">
    <table>
        <tr>
            <td>名称</td>
            <td><input type="text" id="serchName" class="form-control" /></td>
            <td colspan="2">
                <div class="text-center">
                    <button type="button" onclick="sercherQuery()" class="btn btn-info"><span class="glyphicon glyphicon-search">搜索</span> </button>
                </div>
            </td>
            <td>

                <div class="text-center">
                    <button type="button" onclick="deleteLabel()" class="btn btn-warning "><span class="glyphicon glyphicon-trash">批删</span> </button>

                </div>
            </td>
            <td>

                <div class="text-center">

                    <button type="button" onclick="openAddLabel()" class="btn btn-warning "><span class="glyphicon glyphicon-plus">新增</span> </button>

                </div>
            </td>

        </tr>

    </table>

</form>
<table id="labelTable"></table>
</body>
<script>
    $(function(){

        initLabel();
    })
    function initLabel(){
        $("#labelTable").bootstrapTable({
            url:'/ldl/queryLabel',
            toolbar:'#toolbar',
            method: 'post',
            contentType: 'application/x-www-form-urlencoded',//posti求按照表单方式
            pagination:true,//是否展示分页
            showRefresh:true,
            pageNamber:1,//起始页
            pageSize:2,//每页条数
            pageList:[2,5,10,20],
            sidePagination:'server',//分页方式：client客户端分页，server服务端分页（*
            striped:true,//是否显示斑马线
            queryParams:function(){
                return {
                    page:this.pageNumber,
                    rows:this.pageSize
                };
            },
            columns:[
                {field:"abc",checkbox:true},

                {field:"name",title:"名称",width:90},
                {field : "img",title : "图标",width:100,formatter : function(value, row, index) {
                        return '<img src="'+value+'" width="80px" height="80px">';

                    }},

                {field:"sort",title:"排行",width:60},
                {field:"createTime",title:"创建时间",width:90},
                {field : "asd",title : "操作",width:70,formatter : function(value, row, index) {

                        return '<a href="javascript:updateLabel(' + row.id + ');">[详情]</a> ';

                    }}

            ]
        })
    }
//条件查询
    function sercherQuery(){

        var serchName=$("#serchName").val();


        $("#labelTable").bootstrapTable('refresh',{

            query:{
                name:serchName


            }

        })
    }
//删除
    function deleteLabel(){
        var arr = $("#labelTable").bootstrapTable("getSelections");
        if(arr.length<=0){//没有选择
            //bootbox.alert("请至少选择一条!");
            bootbox.alert({
                size: "small",
                title: "提示",
                message: "请至少选择一条!",
                buttons: {
                    ok: {
                        label: '确定',
                        className: 'btn-success'
                    }
                },
                callback: function(){}
            })
        }else{
            bootbox.confirm({
                size: "small",
                title: "提示",
                message: "是否确认删除？",
                buttons: {
                    confirm: {
                        label: '确定',
                        className: 'btn-success'
                    },
                    cancel: {
                        label: '取消',
                        className: 'btn-danger'
                    }
                },
                callback: function(result){
                    if(result){
                        //删除
                        var ids = "";
                        for(var i=0;i<arr.length;i++){
                            ids+=ids==""?arr[i].id:","+arr[i].id;
                        }
                        //alert(ids);
                        $.ajax({
                            url:"/ldl/deleteLabel",
                            type:"post",
                            data:{ids:ids},
                            success:function(){
                                //提示删除成功
                                bootbox.alert({
                                    size: "small",
                                    title: "提示",
                                    message: "删除成功!",
                                    buttons: {
                                        ok: {
                                            label: '确定',
                                            className: 'btn-success'
                                        }
                                    },
                                    callback: function(){}
                                })
                                //刷新表格
                                sercherQuery();
                            }
                        })
                    }
                }
            })
        }
    }
    var res;
    function createAddContent(url){
        $.ajax({
            url:url,
            async:false,//同步
            success:function(data){
                res = data;
            }
        });
        return res;
    }
    //新增
    function openAddLabel(){
        bootbox.dialog({
            title:'新增标签',
            message: createAddContent("/ldl/toAddLabel"),
            closeButton: true,//是否显示关闭按钮
            buttons : {
                "success" : {
                    "label" : "<i class='icon-ok'></i> 保存",
                    "className" : "btn-sm btn-success",
                    "callback" : function() {
                        $.ajax({
                            url:'/ldl/saveLabel',
                            type:'post',
                            data:$("#labelForm").serialize(),
                            success:function(data){
                                //刷新表格
                                //$('#myTable').bootstrapTable('refresh');
                                sercherQuery();
                            }
                        });
                    }
                },
                "cancel" : {
                    "label" : "<i class='icon-info'></i> 取消",
                    "className" : "btn-sm btn-danger",
                    "callback" : function() {

                    }
                }
            }

        });



    }
    //修改回显查询
    function updateLabel(id){
        bootbox.dialog({
            title:'修改图书',
            message: createAddContent("/ldl/toupdateLabel"),
            closeButton: true,//是否显示关闭按钮
            buttons : {
                "success" : {
                    "label" : "<i class='icon-ok'></i> 保存",
                    "className" : "btn-sm btn-success",
                    "callback" : function() {
                        $.ajax({
                            url:'/ldl/saveLabel',
                            type:'post',
                            data:$("#labelForm").serialize(),
                            success:function(data){
                                //刷新表格
                                //$('#myTable').bootstrapTable('refresh');
                                sercherQuery();
                            }
                        });
                    }
                },
                "cancel" : {
                    "label" : "<i class='icon-info'></i> 取消",
                    "className" : "btn-sm btn-danger",
                    "callback" : function() {
                    }
                }
            }
        });
        //回显数据
        $.ajax({
            url:'/ldl/findInfo',
            type:'post',
            async:false,//同步
            data:{id:id},
            success:function(data){

                $("#labelId").val(data.id);
                $("#labelName").val(data.name);
                $("#labelsort").val(data.sort);
                $("#labelRemark").val(data.remark);
                $("#updatefileidimg").val(data.img);
                $('#updatextidimg').val(data.img);
                uploadImg(data.img);
            }
        })
    }
</script>
</html>